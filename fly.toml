app = "withyou-backend"
primary_region = "iad"

[build]
  # Uses your Dockerfile by default

[processes]
  app = "uvicorn backend.app.main:app --host 0.0.0.0 --port 8000"
  worker = "python -m backend.app.worker"

[env]
  PORT = "8000"
  # your code uses APNS_USE_SANDBOX etc via env vars, so those will come from fly secrets

# Only the API process should expose HTTP services.
[[services]]
  processes = ["app"]
  internal_port = 8000
  protocol = "tcp"

  [[services.ports]]
    port = 80
    handlers = ["http"]

  [[services.ports]]
    port = 443
    handlers = ["tls", "http"]

  # Basic health check against your /health endpoint
  [[services.http_checks]]
    interval = "15s"
    grace_period = "10s"
    method = "GET"
    path = "/health"
    protocol = "http"
    timeout = "2s"
